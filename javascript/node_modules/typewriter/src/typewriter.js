var PrioritySequence,Typewriter,assert,charactergenerator,random;assert=require("assert");PrioritySequence=require("./prioritysequence");random=require("./random");charactergenerator=require("./charactergenerator");Typewriter=function(){function e(){this._prioritySequence=new PrioritySequence(function(e){return function(){return e._sequenceLevel=0}}(this))}e.prototype.setTargetDomElement=function(e){assert.ok(e instanceof Element,"TargetDomElement must be an instance of Element");return this.targetDomElement=e};e.prototype.setAccuracy=function(e){assert.strictEqual(typeof e,"number","Accuracy must be a number");assert.ok(e>0&&e<=100,"Accuracy must be greater than 0 and less than or equal to 100");return this.accuracy=e};e.prototype.setMinimumSpeed=function(e){assert.strictEqual(typeof e,"number","MinimumSpeed must be a number");assert.ok(e>0,"MinimumSpeed must be greater than 0");if(this.maximumSpeed!=null&&e>this.maximumSpeed){return this.minimumSpeed=this.maximumSpeed}else{return this.minimumSpeed=e}};e.prototype.setMaximumSpeed=function(e){assert.strictEqual(typeof e,"number","MaximumSpeed must be a number");assert.ok(e>0,"MaximumSpeed must be greater than 0");if(this.minimumSpeed!=null&&this.minimumSpeed>e){return this.maximumSpeed=minimumSpeed}else{return this.maximumSpeed=e}};e.prototype.setKeyboardLayout=function(e){assert.strictEqual(typeof e.getAdjacentCharacter,"function","KeyboardLayout must have an exported getAdjacentCharacter method");return this.keyboardLayout=e};e.prototype._makeChainable=function(e,t){var r;r=Object.create(this);r._sequenceLevel=this._sequenceLevel;this._prioritySequence.then(this._sequenceLevel,function(n){return process.nextTick(function(){return t(function(){if(e!=null){e.call(r)}return n()})})});if(e!=null){this._sequenceLevel++}if(e==null||this.hasOwnProperty("_prioritySequence")){return this}};e.prototype.clear=function(e){return this._makeChainable(e,function(e){return function(t){var r;while((r=e.targetDomElement.lastChild)!=null){e.targetDomElement.removeChild(r)}return t()}}(this))};e.prototype.waitRange=function(e,t,r){return this._makeChainable(r,function(r){return function(r){return setTimeout(r,random.integerInRange(e,t))}}(this))};e.prototype.wait=function(e,t){return this.waitRange(e,e,t)};e.prototype.put=function(e,t){return this._makeChainable(t,function(t){return function(r){var n,i;i=document.createElement("div");i.innerHTML=e;while((n=i.firstChild)!=null){t.targetDomElement.appendChild(n)}return r()}}(this))};e.prototype["delete"]=function(e){return this._makeChainable(e,function(e){return function(t){e.targetDomElement.removeChild(e.targetDomElement.lastChild);return t()}}(this))};e.prototype.type=function(e,t){var r,n,i;n=(this.minimumSpeed+this.maximumSpeed)/2;i=charactergenerator(this.keyboardLayout,this.accuracy,n,e);while((r=i.next())!==null){if(r!=="\b"){this.put(r)}else{this["delete"]()}this.waitRange(~~(1e3/this.maximumSpeed),~~(1e3/this.minimumSpeed))}return this.wait(0,t)};return e}();module.exports=Typewriter;